-------------------------------------------
---ooooooooooooooooooooooooooooooooooooo---
-------------------------------------------
-- RAILWAT TICKET RESERVATION MANAGEMENT --
-------------------------------------------
---ooooooooooooooooooooooooooooooooooooo---
-------------------------------------------



----------------------------------------------------
-- CREATING TABLES
----------------------------------------------------
CREATE TABLE STATION(
  ID NUMBER,
  NAME VARCHAR2(50)
);

CREATE TABLE TRAIN(
  ID NUMBER,
  NAME VARCHAR2(100),
  DEPART_STN NUMBER,
  DEPART_TIME VARCHAR2(10),
  ARRV_STN NUMBER,
  ARRV_TIME VARCHAR2(10),
  TICKETS NUMBER,
  BOOKED NUMBER,
  JOURNEY VARCHAR2(15),
  FARE NUMBER
);

CREATE TABLE DAY_OF_JOURNEY(
  ID NUMBER,
  TRAIN_ID NUMBER,
  DEPART_DAY VARCHAR2(10),
  ARRV_DAY VARCHAR2(10)
);

CREATE TABLE STOPAGE(
  ID NUMBER,
  TRAIN_ID NUMBER,
  STATION_ID NUMBER,
  STATION_TIME VARCHAR2(20)
);

CREATE TABLE BOOKING(
  ID NUMBER,
  TRAIN_ID NUMBER,
  DEPART_STN NUMBER,
  ARRV_STN NUMBER,
  BOOKING_DATE DATE,
  NAME VARCHAR2(50),
  AGE NUMBER
);

----------------------------------------------------
-- CONTRAINTS
----------------------------------------------------

ALTER TABLE STATION ADD CONSTRAINT STATION_PKEY PRIMARY KEY(ID);

ALTER TABLE TRAIN ADD CONSTRAINT TRAIN_PKEY PRIMARY KEY(ID);

ALTER TABLE TRAIN ADD CONSTRAINT DEPART_STN_FKEY FOREIGN KEY(DEPART_STN) REFERENCES STATION(ID);

ALTER TABLE TRAIN ADD CONSTRAINT ARRV_STN_FKEY FOREIGN KEY(ARRV_STN) REFERENCES STATION(ID);

ALTER TABLE DAY_OF_JOURNEY ADD CONSTRAINT DAY_OF_JOURNEY_PKEY PRIMARY KEY(ID);

ALTER TABLE DAY_OF_JOURNEY ADD CONSTRAINT DAY_OF_JOURNEY_TRAIN_FKEY FOREIGN KEY(TRAIN_ID) REFERENCES TRAIN(ID);

ALTER TABLE STOPAGE ADD CONSTRAINT STOPAGE_PKEY PRIMARY KEY(ID);

ALTER TABLE STOPAGE ADD CONSTRAINT TRAIN_ID_FKEY FOREIGN KEY(TRAIN_ID) REFERENCES TRAIN(ID);

ALTER TABLE STOPAGE ADD CONSTRAINT STATION_ID_FKEY FOREIGN KEY(STATION_ID) REFERENCES STATION(ID);

----------------------------------------------------
-- INSERTING VALUES
----------------------------------------------------

-- STATIONS
INSERT INTO STATION VALUES(
  1,
  'Howrah'
);

INSERT INTO STATION VALUES(
  2,
  'Tatanagar'
);

INSERT INTO STATION VALUES(
  3,
  'Bilaspur'
);

INSERT INTO STATION VALUES(
  4,
  'Raipur'
);

INSERT INTO STATION VALUES(
  5,
  'Nagpur'
);

INSERT INTO STATION VALUES(
  6,
  'Bhusaval'
);

INSERT INTO STATION VALUES(
  7,
  'Kharagpur'
);

INSERT INTO STATION VALUES(
  8,
  'Chakradharpur'
);

INSERT INTO STATION VALUES(
  9,
  'Rourkela'
);

INSERT INTO STATION VALUES(
  10,
  'Jharsuguda'
);

INSERT INTO STATION VALUES(
  11,
  'Raigarh'
);

INSERT INTO STATION VALUES(
  12,
  'Durg'
);

INSERT INTO STATION VALUES(
  13,
  'Raj Nandgaon'
);

INSERT INTO STATION VALUES(
  14,
  'Gondia'
);

INSERT INTO STATION VALUES(
  15,
  'Bhandara Road'
);

INSERT INTO STATION VALUES(
  16,
  'Wardha'
);

INSERT INTO STATION VALUES(
  17,
  'Badnera'
);

INSERT INTO STATION VALUES(
  18,
  'Akola'
);

INSERT INTO STATION VALUES(
  19,
  'Shegaon'
);

INSERT INTO STATION VALUES(
  20,
  'Malkapur'
);

INSERT INTO STATION VALUES(
  21,
  'Jalgaon'
);

INSERT INTO STATION VALUES(
  22,
  'Nashik'
);

INSERT INTO STATION VALUES(
  23,
  'Kalyan'
);

INSERT INTO STATION VALUES(
  24,
  'Dadar Central'
);

INSERT INTO STATION VALUES(
  500,
  'Chatrapati Shivaji Maharaj Terminus'
);

-- TRAINS
INSERT INTO TRAIN VALUES(
  1001,
  'Mumbai CSMT AC Duronto Express',
  1,
  '5:45 AM',
  500,
  '8:15 AM',
  100,
  0,
  '26.5 hours',
  2500
);

INSERT INTO TRAIN VALUES(
  1002,
  'Gitanjali Express',
  1,
  '2:05 PM',
  500,
  '9:20 PM',
  90,
  0,
  '31.25 hours',
  3000
);

-- DAY OF JOURNEY
INSERT INTO DAY_OF_JOURNEY VALUES(
  1500,
  1001,
  'MONDAY',
  'TUESDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1501,
  1001,
  'TUESDAY',
  'WEDNESDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1502,
  1001,
  'WEDNESDAY',
  'THURSDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1503,
  1002,
  'SUNDAY',
  'MONDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1504,
  1002,
  'MONDAY',
  'TUESDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1505,
  1002,
  'TUESDAY',
  'THURSDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1506,
  1002,
  'THURSDAY',
  'FRIDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1507,
  1002,
  'FRIDAY',
  'SATURDAY'
);

INSERT INTO DAY_OF_JOURNEY VALUES(
  1508,
  1002,
  'SATURDAY',
  'SUNDAY'
);

-- STOPAGES
INSERT INTO STOPAGE VALUES(
  1997,
  1001,
  1,
  '5:45 AM'
);

INSERT INTO STOPAGE VALUES(
  1998,
  1001,
  2,
  '8:58 AM'
);

INSERT INTO STOPAGE VALUES(
  1999,
  1001,
  3,
  '3:05 PM'
);

INSERT INTO STOPAGE VALUES(
  2000,
  1001,
  4,
  '4:37 PM'
);

INSERT INTO STOPAGE VALUES(
  2001,
  1001,
  5,
  '8:55 PM'
);

INSERT INTO STOPAGE VALUES(
  2002,
  1001,
  6,
  '1:45 AM'
);

INSERT INTO STOPAGE VALUES(
  2003,
  1001,
  500,
  '8:15 AM'
);

INSERT INTO STOPAGE VALUES(
  2004,
  1002,
  1,
  '2:05 PM'
);

INSERT INTO STOPAGE VALUES(
  2005,
  1002,
  7,
  '3:38 PM'
);

INSERT INTO STOPAGE VALUES(
  2006,
  1002,
  2,
  '5:30 PM'
);

INSERT INTO STOPAGE VALUES(
  2007,
  1002,
  8,
  '6:28 PM'
);

INSERT INTO STOPAGE VALUES(
  2008,
  1002,
  9,
  '7:57 PM'
);

INSERT INTO STOPAGE VALUES(
  2009,
  1002,
  19,
  '9:53 PM'
);

INSERT INTO STOPAGE VALUES(
  2010,
  1002,
  11,
  '10:53 PM'
);

INSERT INTO STOPAGE VALUES(
  2011,
  1002,
  3,
  '1:05 AM'
);

INSERT INTO STOPAGE VALUES(
  2012,
  1002,
  4,
  '2:45 AM'
);

INSERT INTO STOPAGE VALUES(
  2013,
  1002,
  12,
  '3:45 AM'
);

INSERT INTO STOPAGE VALUES(
  2014,
  1002,
  13,
  '4:11 AM'
);

INSERT INTO STOPAGE VALUES(
  2015,
  1002,
  14,
  '5:40 AM'
);

INSERT INTO STOPAGE VALUES(
  2016,
  1002,
  15,
  '6:29 AM'
);

INSERT INTO STOPAGE VALUES(
  2017,
  1002,
  5,
  '7:40 AM'
);

INSERT INTO STOPAGE VALUES(
  2018,
  1002,
  16,
  '8:48 AM'
);

INSERT INTO STOPAGE VALUES(
  2019,
  1002,
  17,
  '10:32 AM'
);

INSERT INTO STOPAGE VALUES(
  2020,
  1002,
  18,
  '11:30 AM'
);

INSERT INTO STOPAGE VALUES(
  2021,
  1002,
  19,
  '12:03 PM'
);

INSERT INTO STOPAGE VALUES(
  2022,
  1002,
  20,
  '12:43 PM'
);

INSERT INTO STOPAGE VALUES(
  2023,
  1002,
  6,
  '1:45 PM'
);

INSERT INTO STOPAGE VALUES(
  2024,
  1002,
  21,
  '2:18 PM'
);

INSERT INTO STOPAGE VALUES(
  2025,
  1002,
  22,
  '5:05 PM'
);

INSERT INTO STOPAGE VALUES(
  2026,
  1002,
  23,
  '8:02 PM'
);

INSERT INTO STOPAGE VALUES(
  2027,
  1002,
  24,
  '8:47 PM'
);

INSERT INTO STOPAGE VALUES(
  2028,
  1002,
  500,
  '9:20 PM'
);

----------------------------------------------------
-- DISPLAYING TABLES
----------------------------------------------------

SELECT
  *
FROM
  STATION;

SELECT
  A.ID   AS TRAIN_ID,
  A.NAME AS TRAIN,
  B.NAME AS DEPARTURE,
  A.DEPART_TIME,
  C.NAME AS ARRIVAL,
  A.ARRV_TIME,
  A.TICKETS,
  A.BOOKED
FROM
  TRAIN   A
  INNER JOIN STATION B
  ON A.DEPART_STN = B.ID
  INNER JOIN STATION C
  ON A.ARRV_STN = C.ID;

----------------------------------------------------
-- BOOKING SYSTEM
----------------------------------------------------

-- CREATE SEQUENCE passenger_seq
--  START WITH     1
--  INCREMENT BY   1
--  NOCACHE
--  NOCYCLE

CREATE SEQUENCE BOOKING_SEQ START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

DECLARE
  TRAIN_ID            BOOKING.TRAIN_ID%TYPE;
  ARRV_ID             BOOKING.ARRV_STN%TYPE;
  DEPART_ID           BOOKING.DEPART_STN%TYPE;
  DATE_OF_RESERVATION VARCHAR2(50);
  PASSENGER_NAME      BOOKING.NAME%TYPE;
  PASSENGER_AGE       BOOKING.AGE%TYPE;
  BOOKING_ID          NUMBER;
  BOOKING_DETAILS     BOOKING%ROWTYPE;
BEGIN
  DEPART_ID := &DEPARTURE_STATION_ID;
  ARRV_ID := &ARRIVAL_STATION_ID;
 -- DISPLAY_TRAINS(DEPART_ID, ARRV_ID);
  TRAIN_ID := &TRAIN_ID_YOU_WANT_TO_BOOK;
  DATE_OF_RESERVATION := '&DATE_OF_BOOKING';
  PASSENGER_NAME := '&PASSENGER_NAME';
  PASSENGER_AGE := &PASSENGER_AGE;
  INSERT INTO BOOKING VALUES(
    BOOKING_SEQ.NEXTVAL,
    TRAIN_ID,
    DEPART_ID,
    ARRV_ID,
    TO_DATE(DATE_OF_RESERVATION, 'yyyy-mm-dd'),
    PASSENGER_NAME,
    PASSENGER_AGE
  );
  DBMS_OUTPUT.PUT_LINE('BOOKED SUCCESSFUL');
  BOOKING_ID:= BOOKING_SEQ.CURRVAL;
  SELECT
    * INTO BOOKING_DETAILS
  FROM
    BOOKING B
  WHERE
    B.ID =BOOKING_ID;
  DBMS_OUTPUT.PUT_LINE('------------------BOOKING DETAILS-----------------');
  DBMS_OUTPUT.PUT_LINE('NAME : ' || BOOKING_DETAILS.NAME || ' AGE : ' || BOOKING_DETAILS.AGE || ' DATE : ' || BOOKING_DETAILS.BOOKING_DATE);
  DBMS_OUTPUT.PUT_LINE('--------------------------------------------------');
EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('SOMETHING WENT WRONG');
END;
/

----------------------------------------------------
-- DESCRIPTION OF TABLES
----------------------------------------------------

-- DESC station;
-- DESC train;
-- DESC stopage;



----------------------------------------------------
-- DROPPING CONSTRAINTS
----------------------------------------------------

ALTER TABLE TRAIN DROP CONSTRAINT DEPART_STN_FKEY;

ALTER TABLE TRAIN DROP CONSTRAINT ARRV_STN_FKEY;

ALTER TABLE STOPAGE DROP CONSTRAINT TRAIN_ID_FKEY;

ALTER TABLE STOPAGE DROP CONSTRAINT STATION_ID_FKEY;

ALTER TABLE DAY_OF_JOURNEY DROP CONSTRAINT DAY_OF_JOURNEY_TRAIN_FKEY;

ALTER TABLE STATION DROP CONSTRAINT STATION_PKEY;

ALTER TABLE TRAIN DROP CONSTRAINT TRAIN_PKEY;

ALTER TABLE DAY_OF_JOURNEY DROP CONSTRAINT DAY_OF_JOURNEY_PKEY;

ALTER TABLE STOPAGE DROP CONSTRAINT STOPAGE_PKEY;

DROP SEQUENCE BOOKING_SEQ;

----------------------------------------------------
-- DROPPING TABLES
----------------------------------------------------

DROP TABLE STATION;

DROP TABLE TRAIN;

DROP TABLE DAY_OF_JOURNEY;

DROP TABLE STOPAGE;

DROP TABLE BOOKING;